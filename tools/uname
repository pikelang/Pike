#!/bin/sh

. $NTTOOLS

for a in "$@"
do
  case "$a" in
    --version)
      echo "Fake NT uname version 1.0 by Fredrik Hubinette"
      exit 0
    ;;

    --help)
      echo "Usage: uname [-a] [-m] [-n] [-p] [-r] [-s] [-v]"
      exit 0
    ;;

    --all)  M=yes ; N=yes ; S=yes ; P=yes ;;
    --machine) M=yes ;;
    --nodename) N=yes ;;
    --sysname) S=yes ;;
    --processor) P=yes ;;
    --revision) R=yes ;;

    --*)
      echo "Unknown option $a"
      exit 1
    ;;

    -*)
      case "$a" in
        *m*) M=yes ;;
      esac

      case "$a" in
        *n*) N=yes ;;
      esac

      case "$a" in
        *p*) P=yes ;;
      esac

      case "$a" in
        *s*) S=yes ;;
      esac

      case "$a" in
        *r*) R=yes ;;
      esac

      case "$a" in
        *v*) V=yes ;;
      esac

      case "$a" in
        *a*) M=yes ; N=yes ; S=yes ; V=yes ;;
      esac
    ;;
      
  esac
done

if [ X"$M$N$S$P$R$V" = X ]; then
  S=yes
fi

OUTPUT=

if [ X$S = Xyes ]; then
#  OUTPUT="$OUTPUT Windows_NT"
#  OUTPUT="$OUTPUT `getntenv OS`"
  OUTPUT="$OUTPUT `sprsh cmd /c ver | grep \\\[ | awk -F\[ '{print $1}'`"
fi

if [ X$N = Xyes ]; then
  OUTPUT="$OUTPUT $NTHOST"
fi

if [ X$V = Xyes ]; then
  OUTPUT="$OUTPUT `sprsh cmd /c ver | grep \\\[ | awk -F\\[ '{print $2}' | awk '{print $2}' | sed 's/\\]//'`"
fi

if [ X$M = Xyes ]; then
  OUTPUT="$OUTPUT `getntenv PROCESSOR_ARCHITECTURE`"
fi

if [ X$P = Xyes ]; then
  OUTPUT="$OUTPUT `getntenv PROCESSOR_ARCHITECTURE`"
fi

#Should be release level, so maybe 98, NT, XP and so on would be better.
if [ X$R = Xyes ]; then
  OUTPUT="$OUTPUT `sprsh cmd /c ver | grep \\\[ | awk -F\\[ '{print $2}' | awk '{print $2}' | sed 's/\\]//'`"
fi

echo $OUTPUT

exit 0
